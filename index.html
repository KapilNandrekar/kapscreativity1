<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Inventory Manager</title>
    <style>
        :root {
            --color-primary: #2c3e50;
            --color-secondary: #3498db;
            --color-success: #27ae60;
            --color-danger: #e74c3c;
            --color-warning: #f39c12;
            --color-bg: #ecf0f1;
            --color-white: #ffffff;
            --color-text: #2c3e50;
            --color-border: #bdc3c7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
        }

        .header {
            background-color: var(--color-primary);
            color: var(--color-white);
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .nav {
            display: flex;
            gap: 1rem;
            list-style: none;
            flex-wrap: wrap;
        }

        .nav button {
            background: transparent;
            border: none;
            color: var(--color-white);
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .nav button:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .nav button.active {
            background-color: var(--color-secondary);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--color-white);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: var(--color-primary);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background-color: var(--color-secondary);
            color: var(--color-white);
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--color-success);
            color: var(--color-white);
        }

        .btn-success:hover {
            background-color: #229954;
        }

        .btn-danger {
            background-color: var(--color-danger);
            color: var(--color-white);
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-small {
            padding: 0.3rem 0.6rem;
            font-size: 0.8rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        th {
            background-color: var(--color-primary);
            color: var(--color-white);
            font-weight: 600;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.3rem;
            font-weight: 500;
            color: var(--color-text);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--color-secondary);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--color-secondary), #2980b9);
            color: var(--color-white);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--color-white);
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .close-modal {
            background: transparent;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--color-text);
        }

        .status-badge {
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-delivered {
            background-color: #d4edda;
            color: #155724;
        }

        .status-transit {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .search-box {
            margin-bottom: 1rem;
        }

        .search-box input {
            width: 100%;
            padding: 0.7rem;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            font-size: 1rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .login-container {
            max-width: 400px;
            margin: 3rem auto;
        }

        .alert {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            table {
                font-size: 0.9rem;
            }

            th, td {
                padding: 0.5rem;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Login Screen -->
        <div id="login-screen" class="section active">
            <div class="login-container">
                <div class="card">
                    <h2 style="text-align: center; margin-bottom: 1.5rem;">Book Inventory Manager</h2>
                    <div id="login-alert"></div>
                    <div class="form-group">
                        <label for="login-username">Username</label>
                        <input type="text" id="login-username" placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" placeholder="Enter password">
                    </div>
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;" onclick="login()">Login</button>
                    <p style="text-align: center;">Don't have an account? <a href="#" onclick="showSignup()">Sign up</a></p>
                </div>
            </div>
        </div>

        <!-- Signup Screen -->
        <div id="signup-screen" class="section">
            <div class="login-container">
                <div class="card">
                    <h2 style="text-align: center; margin-bottom: 1.5rem;">Create Account</h2>
                    <div id="signup-alert"></div>
                    <div class="form-group">
                        <label for="signup-username">Username</label>
                        <input type="text" id="signup-username" placeholder="Choose username">
                    </div>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" placeholder="Enter email">
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" placeholder="Choose password">
                    </div>
                    <div class="form-group">
                        <label for="signup-confirm">Confirm Password</label>
                        <input type="password" id="signup-confirm" placeholder="Confirm password">
                    </div>
                    <button class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;" onclick="signup()">Sign Up</button>
                    <p style="text-align: center;">Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div id="main-app" class="section">
            <div class="header">
                <h1>ðŸ“š Book Inventory Manager</h1>
                <ul class="nav">
                    <li><button class="active" onclick="showSection('dashboard')">Dashboard</button></li>
                    <li><button onclick="showSection('books')">Books</button></li>
                    <li><button onclick="showSection('operations')">Operations</button></li>
                    <li><button onclick="showSection('move-history')">Move History</button></li>
                    <li><button onclick="showSection('settings')">Settings</button></li>
                    <li><button onclick="logout()">Logout</button></li>
                </ul>
            </div>

            <div class="container">
                <!-- Dashboard Section -->
                <div id="dashboard" class="section active">
                    <h2 style="margin-bottom: 1.5rem;">Dashboard Overview</h2>
                    <div class="grid">
                        <div class="stat-card">
                            <h3 id="total-books">0</h3>
                            <p>Total Books</p>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, var(--color-success), #229954);">
                            <h3 id="total-quantity">0</h3>
                            <p>Total Quantity</p>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, var(--color-warning), #d68910);">
                            <h3 id="pending-deliveries">0</h3>
                            <p>Pending Deliveries</p>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, var(--color-danger), #c0392b);">
                            <h3 id="total-value">â‚¹0</h3>
                            <p>Inventory Value</p>
                        </div>
                    </div>

                    <div class="card">
                        <h2>Recent Receipts</h2>
                        <table id="recent-receipts">
                            <thead>
                                <tr>
                                    <th>Book Title</th>
                                    <th>Quantity</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div class="card">
                        <h2>Pending Deliveries</h2>
                        <table id="pending-deliveries-table">
                            <thead>
                                <tr>
                                    <th>Book Title</th>
                                    <th>Quantity</th>
                                    <th>Status</th>
                                    <th>Expected Date</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- Books Section -->
                <div id="books" class="section">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h2>Book Inventory</h2>
                            <button class="btn btn-primary" onclick="openAddBookModal()">+ Add New Book</button>
                        </div>
                        <div class="search-box">
                            <input type="text" id="book-search" placeholder="Search books..." onkeyup="filterBooks()">
                        </div>
                        <table id="books-table">
                            <thead>
                                <tr>
                                    <th>Book Title</th>
                                    <th>Author</th>
                                    <th>Unit Cost (â‚¹)</th>
                                    <th>Available Qty</th>
                                    <th>Free Qty</th>
                                    <th>Total Value (â‚¹)</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- Operations Section -->
                <div id="operations" class="section">
                    <div class="card">
                        <h2>Add Receipt</h2>
                        <div class="form-group">
                            <label for="receipt-book">Select Book</label>
                            <select id="receipt-book"></select>
                        </div>
                        <div class="form-group">
                            <label for="receipt-quantity">Quantity</label>
                            <input type="number" id="receipt-quantity" min="1" placeholder="Enter quantity">
                        </div>
                        <div class="form-group">
                            <label for="receipt-date">Receipt Date</label>
                            <input type="date" id="receipt-date">
                        </div>
                        <button class="btn btn-success" onclick="addReceipt()">Add Receipt</button>
                    </div>

                    <div class="card">
                        <h2>Add Delivery</h2>
                        <div class="form-group">
                            <label for="delivery-book">Select Book</label>
                            <select id="delivery-book"></select>
                        </div>
                        <div class="form-group">
                            <label for="delivery-quantity">Quantity</label>
                            <input type="number" id="delivery-quantity" min="1" placeholder="Enter quantity">
                        </div>
                        <div class="form-group">
                            <label for="delivery-contact">Contact Person</label>
                            <input type="text" id="delivery-contact" placeholder="Enter contact name">
                        </div>
                        <div class="form-group">
                            <label for="delivery-date">Expected Delivery Date</label>
                            <input type="date" id="delivery-date">
                        </div>
                        <button class="btn btn-success" onclick="addDelivery()">Add Delivery</button>
                    </div>
                </div>

                <!-- Move History Section -->
                <div id="move-history" class="section">
                    <div class="card">
                        <h2>Movement History</h2>
                        <div class="search-box">
                            <input type="text" id="history-search" placeholder="Search by reference code or book..." onkeyup="filterHistory()">
                        </div>
                        <table id="history-table">
                            <thead>
                                <tr>
                                    <th>Reference Code</th>
                                    <th>Type</th>
                                    <th>Book Title</th>
                                    <th>Quantity</th>
                                    <th>Contact</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings" class="section">
                    <div class="card">
                        <h2>Warehouse Settings</h2>
                        <div class="form-group">
                            <label for="warehouse-name">Warehouse Name</label>
                            <input type="text" id="warehouse-name" placeholder="Enter warehouse name">
                        </div>
                        <div class="form-group">
                            <label for="warehouse-address">Address</label>
                            <input type="text" id="warehouse-address" placeholder="Enter address">
                        </div>
                        <div class="form-group">
                            <label for="warehouse-location">Location</label>
                            <input type="text" id="warehouse-location" placeholder="Enter location">
                        </div>
                        <button class="btn btn-primary" onclick="saveWarehouse()">Save Settings</button>
                    </div>

                    <div class="card">
                        <h2>Account Settings</h2>
                        <p><strong>Username:</strong> <span id="current-username"></span></p>
                        <p><strong>Email:</strong> <span id="current-email"></span></p>
                        <button class="btn btn-danger" onclick="logout()" style="margin-top: 1rem;">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Book Modal -->
    <div id="book-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="book-modal-title">Add New Book</h2>
                <button class="close-modal" onclick="closeBookModal()">&times;</button>
            </div>
            <div id="book-modal-alert"></div>
            <form id="book-form">
                <div class="form-group">
                    <label for="book-title">Book Title *</label>
                    <input type="text" id="book-title" required>
                </div>
                <div class="form-group">
                    <label for="book-author">Author *</label>
                    <input type="text" id="book-author" required>
                </div>
                <div class="form-group">
                    <label for="book-cost">Unit Cost (â‚¹) *</label>
                    <input type="number" id="book-cost" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="book-available">Available Quantity *</label>
                    <input type="number" id="book-available" min="0" required>
                </div>
                <div class="form-group">
                    <label for="book-free">Free Quantity</label>
                    <input type="number" id="book-free" min="0" value="0">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Save Book</button>
            </form>
        </div>
    </div>

    <script>
        // Data Storage
        let users = [{username: 'admin', email: 'admin@bookstore.com', password: 'admin123'}];
        let currentUser = null;
        let books = [];
        let receipts = [];
        let deliveries = [];
        let moveHistory = [];
        let warehouse = {name: '', address: '', location: ''};
        let editingBookId = null;

        // Initialize with sample data
        function initializeSampleData() {
            books = [
                {id: 1, title: 'The Great Gatsby', author: 'F. Scott Fitzgerald', unitCost: 299, available: 50, free: 5},
                {id: 2, title: 'To Kill a Mockingbird', author: 'Harper Lee', unitCost: 349, available: 35, free: 3},
                {id: 3, title: '1984', author: 'George Orwell', unitCost: 399, available: 40, free: 4},
                {id: 4, title: 'Pride and Prejudice', author: 'Jane Austen', unitCost: 279, available: 30, free: 2}
            ];

            receipts = [
                {id: 1, bookId: 1, bookTitle: 'The Great Gatsby', quantity: 20, status: 'delivered', date: '2025-11-20'},
                {id: 2, bookId: 2, bookTitle: 'To Kill a Mockingbird', quantity: 15, status: 'delivered', date: '2025-11-19'}
            ];

            deliveries = [
                {id: 1, bookId: 3, bookTitle: '1984', quantity: 10, contact: 'Raj Kumar', status: 'pending', date: '2025-11-25'},
                {id: 2, bookId: 4, bookTitle: 'Pride and Prejudice', quantity: 8, contact: 'Priya Shah', status: 'transit', date: '2025-11-23'}
            ];

            moveHistory = [
                {id: 1, refCode: 'RCP-001', type: 'Receipt', bookTitle: 'The Great Gatsby', quantity: 20, contact: 'N/A', date: '2025-11-20', status: 'delivered'},
                {id: 2, refCode: 'DEL-001', type: 'Delivery', bookTitle: '1984', quantity: 10, contact: 'Raj Kumar', date: '2025-11-25', status: 'pending'}
            ];
        }

        // Authentication Functions
        function showLogin() {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('login-screen').classList.add('active');
        }

        function showSignup() {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('signup-screen').classList.add('active');
        }

        function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const alertDiv = document.getElementById('login-alert');

            if (!username || !password) {
                alertDiv.innerHTML = '<div class="alert alert-error">Please enter username and password</div>';
                return;
            }

            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = user;
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById('main-app').classList.add('active');
                document.getElementById('current-username').textContent = user.username;
                document.getElementById('current-email').textContent = user.email;
                updateDashboard();
                renderBooks();
                renderHistory();
                populateBookSelects();
            } else {
                alertDiv.innerHTML = '<div class="alert alert-error">Invalid username or password</div>';
            }
        }

        function signup() {
            const username = document.getElementById('signup-username').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirm = document.getElementById('signup-confirm').value;
            const alertDiv = document.getElementById('signup-alert');

            if (!username || !email || !password || !confirm) {
                alertDiv.innerHTML = '<div class="alert alert-error">All fields are required</div>';
                return;
            }

            if (password !== confirm) {
                alertDiv.innerHTML = '<div class="alert alert-error">Passwords do not match</div>';
                return;
            }

            if (users.find(u => u.username === username)) {
                alertDiv.innerHTML = '<div class="alert alert-error">Username already exists</div>';
                return;
            }

            users.push({username, email, password});
            alertDiv.innerHTML = '<div class="alert alert-success">Account created successfully! Please login.</div>';
            setTimeout(showLogin, 2000);
        }

        function logout() {
            currentUser = null;
            document.getElementById('login-username').value = '';
            document.getElementById('login-password').value = '';
            showLogin();
        }

        // Navigation Functions
        function showSection(sectionName) {
            document.querySelectorAll('#main-app .container > .section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionName).classList.add('active');
            
            document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');

            if (sectionName === 'dashboard') updateDashboard();
            if (sectionName === 'books') renderBooks();
            if (sectionName === 'move-history') renderHistory();
            if (sectionName === 'operations') populateBookSelects();
        }

        // Dashboard Functions
        function updateDashboard() {
            document.getElementById('total-books').textContent = books.length;
            document.getElementById('total-quantity').textContent = books.reduce((sum, b) => sum + b.available, 0);
            document.getElementById('pending-deliveries').textContent = deliveries.filter(d => d.status === 'pending').length;
            document.getElementById('total-value').textContent = 'â‚¹' + books.reduce((sum, b) => sum + (b.unitCost * b.available), 0).toLocaleString();

            // Recent receipts
            const recentReceiptsBody = document.querySelector('#recent-receipts tbody');
            recentReceiptsBody.innerHTML = receipts.slice(0, 5).map(r => `
                <tr>
                    <td>${r.bookTitle}</td>
                    <td>${r.quantity}</td>
                    <td><span class="status-badge status-${r.status}">${r.status}</span></td>
                    <td>${r.date}</td>
                </tr>
            `).join('');

            // Pending deliveries
            const pendingBody = document.querySelector('#pending-deliveries-table tbody');
            const pending = deliveries.filter(d => d.status !== 'delivered');
            pendingBody.innerHTML = pending.length > 0 ? pending.map(d => `
                <tr>
                    <td>${d.bookTitle}</td>
                    <td>${d.quantity}</td>
                    <td><span class="status-badge status-${d.status}">${d.status}</span></td>
                    <td>${d.date}</td>
                </tr>
            `).join('') : '<tr><td colspan="4" style="text-align: center;">No pending deliveries</td></tr>';
        }

        // Book Functions
        function renderBooks() {
            const tbody = document.querySelector('#books-table tbody');
            tbody.innerHTML = books.map(book => `
                <tr>
                    <td>${book.title}</td>
                    <td>${book.author}</td>
                    <td>â‚¹${book.unitCost}</td>
                    <td>${book.available}</td>
                    <td>${book.free}</td>
                    <td>â‚¹${(book.unitCost * book.available).toLocaleString()}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-small" onclick="editBook(${book.id})">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteBook(${book.id})">Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function filterBooks() {
            const search = document.getElementById('book-search').value.toLowerCase();
            const rows = document.querySelectorAll('#books-table tbody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        function openAddBookModal() {
            editingBookId = null;
            document.getElementById('book-modal-title').textContent = 'Add New Book';
            document.getElementById('book-form').reset();
            document.getElementById('book-modal').classList.add('active');
        }

        function editBook(id) {
            const book = books.find(b => b.id === id);
            if (book) {
                editingBookId = id;
                document.getElementById('book-modal-title').textContent = 'Edit Book';
                document.getElementById('book-title').value = book.title;
                document.getElementById('book-author').value = book.author;
                document.getElementById('book-cost').value = book.unitCost;
                document.getElementById('book-available').value = book.available;
                document.getElementById('book-free').value = book.free;
                document.getElementById('book-modal').classList.add('active');
            }
        }

        function deleteBook(id) {
            if (confirm('Are you sure you want to delete this book?')) {
                books = books.filter(b => b.id !== id);
                renderBooks();
                updateDashboard();
            }
        }

        function closeBookModal() {
            document.getElementById('book-modal').classList.remove('active');
            document.getElementById('book-modal-alert').innerHTML = '';
        }

        document.getElementById('book-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const title = document.getElementById('book-title').value;
            const author = document.getElementById('book-author').value;
            const unitCost = parseFloat(document.getElementById('book-cost').value);
            const available = parseInt(document.getElementById('book-available').value);
            const free = parseInt(document.getElementById('book-free').value);

            if (editingBookId) {
                const book = books.find(b => b.id === editingBookId);
                book.title = title;
                book.author = author;
                book.unitCost = unitCost;
                book.available = available;
                book.free = free;
            } else {
                const newBook = {
                    id: books.length > 0 ? Math.max(...books.map(b => b.id)) + 1 : 1,
                    title, author, unitCost, available, free
                };
                books.push(newBook);
            }

            renderBooks();
            populateBookSelects();
            updateDashboard();
            closeBookModal();
        });

        // Operations Functions
        function populateBookSelects() {
            const receiptSelect = document.getElementById('receipt-book');
            const deliverySelect = document.getElementById('delivery-book');
            const options = books.map(b => `<option value="${b.id}">${b.title}</option>`).join('');
            receiptSelect.innerHTML = '<option value="">Select a book</option>' + options;
            deliverySelect.innerHTML = '<option value="">Select a book</option>' + options;
        }

        function addReceipt() {
            const bookId = parseInt(document.getElementById('receipt-book').value);
            const quantity = parseInt(document.getElementById('receipt-quantity').value);
            const date = document.getElementById('receipt-date').value;

            if (!bookId || !quantity || !date) {
                alert('Please fill all fields');
                return;
            }

            const book = books.find(b => b.id === bookId);
            if (book) {
                book.available += quantity;
                const receipt = {
                    id: receipts.length + 1,
                    bookId,
                    bookTitle: book.title,
                    quantity,
                    status: 'delivered',
                    date
                };
                receipts.push(receipt);

                const history = {
                    id: moveHistory.length + 1,
                    refCode: `RCP-${String(receipts.length).padStart(3, '0')}`,
                    type: 'Receipt',
                    bookTitle: book.title,
                    quantity,
                    contact: 'N/A',
                    date,
                    status: 'delivered'
                };
                moveHistory.push(history);

                alert('Receipt added successfully!');
                document.getElementById('receipt-book').value = '';
                document.getElementById('receipt-quantity').value = '';
                document.getElementById('receipt-date').value = '';
                updateDashboard();
            }
        }

        function addDelivery() {
            const bookId = parseInt(document.getElementById('delivery-book').value);
            const quantity = parseInt(document.getElementById('delivery-quantity').value);
            const contact = document.getElementById('delivery-contact').value;
            const date = document.getElementById('delivery-date').value;

            if (!bookId || !quantity || !contact || !date) {
                alert('Please fill all fields');
                return;
            }

            const book = books.find(b => b.id === bookId);
            if (book) {
                if (book.available < quantity) {
                    alert('Insufficient stock available!');
                    return;
                }

                book.available -= quantity;
                const delivery = {
                    id: deliveries.length + 1,
                    bookId,
                    bookTitle: book.title,
                    quantity,
                    contact,
                    status: 'pending',
                    date
                };
                deliveries.push(delivery);

                const history = {
                    id: moveHistory.length + 1,
                    refCode: `DEL-${String(deliveries.length).padStart(3, '0')}`,
                    type: 'Delivery',
                    bookTitle: book.title,
                    quantity,
                    contact,
                    date,
                    status: 'pending'
                };
                moveHistory.push(history);

                alert('Delivery added successfully!');
                document.getElementById('delivery-book').value = '';
                document.getElementById('delivery-quantity').value = '';
                document.getElementById('delivery-contact').value = '';
                document.getElementById('delivery-date').value = '';
                updateDashboard();
            }
        }

        // Move History Functions
        function renderHistory() {
            const tbody = document.querySelector('#history-table tbody');
            tbody.innerHTML = moveHistory.map(h => `
                <tr>
                    <td>${h.refCode}</td>
                    <td>${h.type}</td>
                    <td>${h.bookTitle}</td>
                    <td>${h.quantity}</td>
                    <td>${h.contact}</td>
                    <td>${h.date}</td>
                    <td><span class="status-badge status-${h.status}">${h.status}</span></td>
                </tr>
            `).join('');
        }

        function filterHistory() {
            const search = document.getElementById('history-search').value.toLowerCase();
            const rows = document.querySelectorAll('#history-table tbody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        // Settings Functions
        function saveWarehouse() {
            warehouse.name = document.getElementById('warehouse-name').value;
            warehouse.address = document.getElementById('warehouse-address').value;
            warehouse.location = document.getElementById('warehouse-location').value;
            alert('Warehouse settings saved successfully!');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeSampleData();
            document.getElementById('receipt-date').valueAsDate = new Date();
            document.getElementById('delivery-date').valueAsDate = new Date();
        });
    </script>
</body>
</html>